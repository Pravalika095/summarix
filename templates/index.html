<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Summarix - Text Summarizer</title>
  <style>
    :root { --bg:#0f1724; --card:#0b1220; --text:#e6eef8; --muted:#9aa8c2; --accent:#7da0ff; --border:#173044; }
    [data-theme="light"] { --bg:#f4f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280; --accent:#5c6cff; --border:#e6eef8; }
    html,body{height:100%;margin:0}
    body{background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;padding:20px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    /* Floating animation keyframes (slow up/down) */
    @keyframes floaty {
      0%   { transform: translateY(0px); }
      50%  { transform: translateY(-12px); } /* change amplitude here */
      100% { transform: translateY(0px); }
    }
    h1 {
      margin:0;
      font-size:28px;
      display:inline-block;
      /* apply slow up/down float */
      animation: floaty 6s ease-in-out infinite;
      will-change: transform;
      /* subtle glow */
      text-shadow: 0 6px 18px rgba(125,160,255,0.12);
    }
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:14px}
    label{display:block;margin-bottom:6px;font-weight:600;color:var(--muted)}
    input[type="text"],textarea{width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)}
    textarea{min-height:260px;resize:vertical}
    .char{float:right;color:var(--muted);font-size:13px}
    .ratio-control { display:flex; gap:12px; align-items:center; margin-top:8px; margin-bottom:8px; }
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-primary{background:var(--accent);color:white}
    .btn-secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
    .error{background:#53131f;padding:10px;border-left:4px solid #ff6b6b;color:#ffd6d6;border-radius:8px;margin-top:10px}
    .summary-content{white-space:pre-wrap;background:linear-gradient(180deg,#071025,#0b1220);padding:12px;border-radius:8px;margin-top:10px;border:1px solid var(--border)}
    .chat-container{max-height:300px;overflow:auto;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px}
  </style>
</head>
<body data-theme="dark">
  <div class="container">
    <header>
      <h1>✨ Summarix</h1>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn btn-secondary" onclick="loadExample()">Example</button>
        <button class="btn btn-secondary" id="themeBtn" onclick="toggleTheme()">Theme</button>
      </div>
    </header>

    <div class="card">
      <form id="form" method="POST">
        <div style="margin-bottom:12px">
          <label for="url">Paste link (URL) — optional</label>
          <input id="url" name="url" type="text" placeholder="https://example.com/article" value="{{ url_value|default('') }}">
          <small style="color:var(--muted)">If both link and text are provided, the link will be used.</small>
        </div>

        <div style="margin-bottom:8px">
          <label for="text">Paste text — optional</label>
          <textarea id="text" name="text" placeholder="Enter or paste text...">{{ original_text|e }}</textarea>
          <div class="char" id="charCounter"><span id="charCount">0</span> / {{ max_length|default(200000) }} chars</div>
        </div>

        <div class="ratio-control">
          <label for="ratio" style="color:var(--muted);margin-bottom:0">Summary length</label>
          <input id="ratio" name="ratio" type="range" min="0.1" max="0.9" step="0.1" value="{{ ratio|default(0.3) }}" style="flex:1">
          <div style="min-width:60px;font-weight:700;color:var(--muted)" id="ratioValue">{{ ((ratio|default(0.3)) * 100)|round|int }}%</div>
        </div>

        <div style="margin-top:12px">
          <button class="btn btn-primary" type="submit">Summarize</button>
        </div>
      </form>

      {% if error_message %}
      <div class="error" role="alert">{{ error_message }}</div>
      {% endif %}

      {% if stats %}
      <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">Original words<br><strong>{{ stats.original_words|intcomma }}</strong></div>
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">Original chars<br><strong>{{ stats.original_chars|intcomma }}</strong></div>
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">Summary words<br><strong>{{ stats.summary_words|intcomma }}</strong></div>
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">Summary chars<br><strong>{{ stats.summary_chars|intcomma }}</strong></div>
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">Compression<br><strong>{{ stats.compression_ratio }}%</strong></div>
      </div>
      {% endif %}
    </div>

    {% if summary %}
    <div class="card">
      <h2 style="margin:0 0 8px 0">Summary</h2>
      <div id="summaryContent" class="summary-content">{{ summary }}</div>
      <div style="margin-top:10px">
        <button class="btn btn-primary" onclick="copySummary()" style="background:#16a34a">Copy</button>
        <button class="btn btn-secondary" onclick="downloadSummary()">Download</button>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px 0">Ask about your summary</h2>
      <div id="chatContainer" class="chat-container">
        <div style="padding:8px;color:var(--muted)">Ask something like "What is this about?", "Key points", or "Make it shorter".</div>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <input id="chatInput" type="text" placeholder="Ask a question..." style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--border)">
        <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
      </div>
    </div>
    {% endif %}
  </div>

  <script>
    // Theme persistence
    (function(){
      const saved = localStorage.getItem('theme') || 'dark';
      document.body.setAttribute('data-theme', saved === 'light' ? 'light' : 'dark');
    })();

    function toggleTheme(){
      const cur = document.body.getAttribute('data-theme') || 'dark';
      const next = cur === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    }

    // Char counter
    const ta = document.getElementById('text');
    const cc = document.getElementById('charCount');
    const maxLen = {{ max_length|default(200000) }};
    function updateCount(){
      if (!ta) return;
      cc.textContent = ta.value.length.toLocaleString();
    }
    if (ta){
      ta.addEventListener('input', updateCount);
      updateCount();
    }

    // Ratio UI
    const ratio = document.getElementById('ratio');
    const ratioValue = document.getElementById('ratioValue');
    if (ratio && ratioValue){
      ratio.addEventListener('input', () => { ratioValue.textContent = Math.round(ratio.value*100) + '%'; });
    }

    // Copy / download helpers
    function copySummary(){
      const el = document.getElementById('summaryContent');
      if (!el) return;
      navigator.clipboard.writeText(el.textContent).then(()=>alert('Summary copied'));
    }
    function downloadSummary(){
      const el = document.getElementById('summaryContent'); if (!el) return;
      const blob = new Blob([el.textContent], {type:'text/plain'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'summary.txt'; document.body.appendChild(a); a.click(); document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Chatbot
    const chatInput = document.getElementById('chatInput');
    const chatContainer = document.getElementById('chatContainer');
    const summaryText = {% if summary %}{{ summary|tojson|safe }}{% else %}null{% endif %};

    async function sendChatMessage(){
      if (!chatInput || !summaryText) return;
      const q = chatInput.value.trim(); if (!q) return;
      const user = document.createElement('div'); user.style='text-align:right;padding:8px;margin-top:8px;background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;border-radius:8px;'; user.textContent=q; chatContainer.appendChild(user);
      chatInput.value='';
      try {
        const res = await fetch('/api/chatbot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:q, summary:summaryText})});
        const data = await res.json();
        const bot = document.createElement('div'); bot.style='padding:8px;margin-top:8px;background:transparent;border-radius:8px;'; bot.textContent = data.answer || data.error || 'Error'; chatContainer.appendChild(bot);
      } catch(err){
        const bot = document.createElement('div'); bot.style='padding:8px;margin-top:8px;background:transparent;border-radius:8px;'; bot.textContent='Network error'; chatContainer.appendChild(bot);
      }
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    if (chatInput){ chatInput.addEventListener('keypress', (e)=>{ if (e.key==='Enter') sendChatMessage(); }); }

    // Example (longer)
    function loadExample(){
      const ex = `Artificial Intelligence (AI) has become one of the most transformative technologies in the 21st century. It refers to machines and systems that can perform tasks that normally require human intelligence — such as perception, reasoning, learning, and planning. AI is an umbrella term that includes machine learning, deep learning, and more specialized subfields. Machine Learning enables systems to automatically learn patterns from data and improve with experience. Deep Learning, which uses neural networks with many layers, has powered breakthroughs in computer vision, natural language processing, and speech recognition.

Applications of AI are widespread: recommendation systems powering e-commerce, virtual assistants on smartphones, medical imaging diagnostics, autonomous vehicles navigating complex environments, financial modeling and fraud detection, and much more. As organizations collect larger datasets and compute becomes cheaper, AI models grow in capability and complexity. However, AI also raises important ethical questions — fairness and bias in models, privacy concerns with sensitive data, security risks from adversarial attacks, and potential displacement of certain jobs.

Practical deployment of AI requires careful validation, monitoring, and governance. Ensuring datasets are representative, models are interpretable where possible, and systems are robust to edge cases helps reduce harm. Collaboration between domain experts, data scientists, and ethicists is essential when creating systems that impact people.`;
      if (ta){ ta.value = ex; updateCount(); }
    }

    // Ctrl/Cmd+Enter to submit from textarea
    document.addEventListener('keydown', function(e){
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        const form = document.getElementById('form');
        if (form && document.activeElement === ta) form.submit();
      }
    }); 
  </script>
</body>
</html>